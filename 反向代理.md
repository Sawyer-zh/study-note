# 反向代理

写在前面：通常的代理是代理client的请求交给server(代理服务器直接与server交流)，然后server响应请求，反向代理则是`反向代理服务器`代理存在用户想要信息的server的响应，提供给client(反向代理服务器直接与client交流)，所以才叫做反向

很久以前，老王去饭店吃饭，需要先到饭店，七荤八素点好菜，坐等饭菜上桌，然后大快朵颐，不亦乐乎。

有了第三方订餐外卖平台（**代理**），老王懒得动身前往饭店，老王打个电话或用APP，先选好某个饭店，再点好菜，外卖小哥会送上门来。

由于某个品牌的饭店口碑特别好，食客络绎不绝涌入，第三方订餐电话也不绝于耳，但是限于饭店接待能力有限，无法提供及时服务，很多食客等得不耐烦了，纷纷铩羽而归，饭店老总看着煮熟的鸭子飞走了，心疼不已。

痛定思痛，老总又成立了几个连锁饭店，形成一个集群，对外提供统一标准的菜品服务，电话订餐电话400-xxx-7777，**当食客涌入饭店总台，总台将食客用大巴运到各个连锁店，这样食客既不需要排队**，各连锁店都能高速运转起来，一举两得，老总乐开了花，并为此种运作模式起名为**“反向代理”（Reverse Proxy)**

**反向代理**
在计算机世界里，由于单个服务器的处理客户端（用户）请求能力有一个极限，当用户的接入请求蜂拥而入时，会造成服务器忙不过来的局面，可以使用多个服务器来共同分担成千上万的用户请求，这些服务器提供相同的服务，对于用户来说，根本感觉不到任何差别

![](http://oklbfi1yj.bkt.clouddn.com/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/1.jpg)

**反向代理的实现**
1）需要有一个负载均衡设备来分发用户请求，将用户请求分发到空闲的服务器上

2）服务器返回自己的服务到负载均衡设备

3）负载均衡将服务器的服务返回用户

以上的潜台词是：**用户和负载均衡设备直接通信**，**也意味着用户做服务器域名解析时，解析得到的IP其实是负载均衡的IP，而不是服务器的IP**，这样有一个好处是，当新加入/移走服务器时，仅仅需要修改负载均衡的服务器列表，而不会影响现有的服务

谈完反向代理服务，再来谈谈终端用户常用的代理服务

**代理**
1）用户希望代理服务器帮助自己与用户要访问的服务器通信，为了实现此目标，需要以下工作：

a) 用户IP报文的目的IP = 代理服务器IP
b) 用户报文端口号 = 代理服务器监听端口号
c) HTTP 消息里的URL要提供服务器的链接

2）代理服务器可以根据c)里的链接与服务器直接通信

3）服务器返回网页

4）代理服务器打包3）中的网页，返回用户

**代理服务器应用场景**
**场景一**
**如果不采用代理，用户的IP、端口号直接暴露在Internet**（尽管地址转换NAT），外部主可以根据IP、端口号来开采主机安全漏洞，所以在企业网，一般都是采用代理服务器访问互联网

**那有同学会有疑问，那代理服务器就没有安全漏洞吗？**
相比千千万万的用户主机，代理服务器数量有限，修补安全漏洞更方便快捷

**场景二**
在一个超大型局域网，德高望重的家长觉得小盆友们“**幼稚**”、“**有时还有点单纯**”，外部的世界是洪水猛兽，为了不让小盆友们学坏，决定不让小盆友们访问一些网站，可小盆友们有强烈的逆反心理，侬越是不让我看，我越是想看，于是小盆友们使用了代理服务器，这些代理服务器将禁止访问的网页打包好，然后再转交给小盆友，仅此而已

当然**代理服务器不能在禁止名单当中**，否则还是不能访问禁止的网页

**反向代理的好处**

避免服务器直接暴露在Internet上









